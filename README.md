<h1>OpenVAS Vulnerability Management Lab</h1>


<h2>Description</h2>
<br />Today we will be setting up OpenVAS vulnerability scanner and running scan on vulnerable devices in Azure cloud<br />

<img src="https://i.imgur.com/PbrCLTK.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>


<h2>Prerequisites</h2>

- <b>Computer with the Internet</b> 
- <b>Azure Account - May be Possible to do with Free Subscription</b>

<h2>Create your free azure account via links below </h2>

<a href="https://azure.microsoft.com/en-us/free/">Azure Sign-Up</a>
<br />
<a href="https://portal.azure.com">Azure Login</a>

<h2>Preparing Vulnerability Management Scanner:</h2>

<p align="center">
Azure home screen: <br/>
<img src="https://i.imgur.com/pXMfp3Z.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<br />
<br />
Search for OpenVAS from within the marketplace window:  <br/>
<img src="https://i.imgur.com/63K4Wgh.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<br />
<br />
It Should look like this: <br/>
<img src="https://i.imgur.com/gkfxzm9.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
 <br />
<br />
 Select "start with pre set config: <br/>
 <img src="https://i.imgur.com/OEtqLP8.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<br />
<br />
Just select the Dev/Test Option:  <br/>
<img src="https://i.imgur.com/8ZQbwSl.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<br />
<br />
On This Screen Copy the settings Below Mainly (Resource Group/ Region):  <br/>
<img src="https://i.imgur.com/b458vUl.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<br />
<br />
Setup you OpenVas VM Credentials:  <br/>
<img src="https://i.imgur.com/85VfYbw.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<br />
<br />
Once Completed Click Monitor tab at the top and disable "Boot Diagnostics" then click "review and Create at the bottom left":  <br/>
<img src="https://i.imgur.com/J2gBBlr.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>

Click Create at the bottom left to spin up the OpenVAS VM:  <br/>
<img src="https://i.imgur.com/IYYatNG.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<br />
<br />
After Spinning up it should display below:  <br/>
<img src="https://i.imgur.com/DBPXF82.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<br />
<br />
Once loaded click "Go To Resource" and on that page not down the "Public IP":  <br/>
- <b>Note This down as we are going to SSH into it</b> 
<img src="https://i.imgur.com/C1GFNsF.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<br />
<br />
<br />
<br />
We are going to SSH into the VM that we created (remember user name and PW we setup earlier): <br/>
- <b>Windows - Open Powershell</b>
- <b>Mac - Open up Terminal</b>
<img src="https://i.imgur.com/irU6FGe.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<br />
<br />
After SSHing into OpenVAS it should look like :  <br/>
- Note Down your username and password for the webportal and grabthe web portal link above password
<img src="https://i.imgur.com/JNjiqyk.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<br />
<br />

<br />
<br />
Once on the web portal link it should look like this :  <br/>
<img src="https://i.imgur.com/DdkzZPj.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<br />
<br />
<br />
<br />
Login to the OpenVAS Dashboard and it should look as so :  <br/>
<img src="https://i.imgur.com/etDMsN2.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<br />
<br />

<h2>Creating a Client Virtual Machine And Making it Vulnerable</h2>

- <b>We will now be setting up another VM in Azure this one will be a vulnerable windows 10 environment</b>
- <b>Headback to Azure Portal website in the 1st step and click "create VM"</b>
<br />
<br />
  Configure the VM with these settings below :  <br/>
<img src="https://i.imgur.com/5SlQiJs.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<img src="https://i.imgur.com/C3mC7zS.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<br />
<br />
Click Next and while on the networking tab for the windows 10 VM ensure that its on the same virtual network as the OpenVAS Server and once completed click create at the bottom left and wait for it to deploy:  <br/>
<img src="https://i.imgur.com/bpi4ixA.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<img src="https://i.imgur.com/WEO5pqL.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<img src="https://i.imgur.com/LxIstla.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<br />
Once you are on the Overview tab after clicking "go To Resource" note the public IP as we are going to RDP into it:  <br/>
<img src="https://i.imgur.com/pDDSUfb.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<br />
<br />
Next open up remote desktop in windows and login to the windows 10 machine :  <br/>
<img src="https://i.imgur.com/UdL9LTZ.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<img src="https://i.imgur.com/AHuUp61.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
- <b>it should load up a windows desktop"</b>
<img src="https://i.imgur.com/xTBy3Lw.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<br />
<br />
Once Logged into the the Windows VM we are going to disable the firewall (just type firewall in the bottom left section) :  <br/>

<img src="https://i.imgur.com/tlgmv1a.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<img src="https://i.imgur.com/KlWHIyS.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<img src="https://i.imgur.com/WGWk825.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>

<br />
<br />
Next we are going to install some old software for our OpenVAS to scan and find :  <br/>
- <b>In this lab i will be installing super old versions of Firefox, Adobe Reader, VLC Player</b>
<img src="https://i.imgur.com/Z6B20al.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<img src="https://i.imgur.com/a6CRA2a.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<img src="https://i.imgur.com/Awh530W.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<br />
<br />After Installing all the programs you can just reboot the windows VM  <br/>

<h2>Configuring OpenVAS to Perform and Unauthenicated Scan Against Our Vulnerable VM </h2>

<br />
<br />
 Login to OpenVAS and go to Assets--->Hosts---->New Host:  <br/>

 
<img src="https://i.imgur.com/KqTaHob.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<img src="https://i.imgur.com/KqTaHob.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>

<br />
Once There it will prompt you to enter a host IP so you would enter the private IP for your vulnerable windows 10 machine <br/>
<img src="https://i.imgur.com/FEhAp92.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<img src="https://i.imgur.com/6vdjkxM.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<br />It should look like this when the host is created<br/>
<img src="https://i.imgur.com/s2QDv9S.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<br />Click Create target from host and type in the name you want you scan to be (keep all settings)<br/>
<img src="https://i.imgur.com/bP8qAQ8.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<img src="https://i.imgur.com/6SU8VeT.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>

<br />Creating a task to start the scan on the target<br/>

<img src="https://i.imgur.com/6NOxLjo.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<img src="https://i.imgur.com/3w9kcez.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<img src="https://i.imgur.com/SdsR8EN.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<img src="https://i.imgur.com/dRLDZ3G.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<br />When you are ready you can click start (IT MAY TAKE A WHILE TO COMPLETE SCAN)<br/>
<img src="https://i.imgur.com/Lr8L098.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>

<br />Example Scan<br/>
<img src="https://i.imgur.com/LNxRkje.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<br />In the results tab you will find the vulnerabilities that where scanned (Look through the different tabs and investigate)<br/>
<img src="https://i.imgur.com/0eFl0Ro.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>

<h2>Configuring OpenVAS To Do Credentialed Scan On Vulnerable VM </h2>

<br />We will have to disable (User Acccount Control) <br/>
<img src="https://i.imgur.com/v3LO4Wv.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<br />We will have to enable remote registry from the service tab<br/>
<img src="https://i.imgur.com/zVi8OBb.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<br />We will have to create a registry Key<br/>
- <b>In registry editor Navigate to the following path:  HKEY_LOCAL_MACHINE----> SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System key </b>
- <b>Create a new DWORD (32-bit) value with the following properties:  Name: LocalAccountTokenFilterPolicy  Value: 1 </b>
<img src="https://i.imgur.com/cJyCM3t.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<img src="https://i.imgur.com/g8aY35k.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>

<br />Go back to OpenVAS: we are going to setup the credentialed scan to give OpenVAS admin right to scan the vulnerable VM<br/>

<img src="https://i.imgur.com/5TFQXV1.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<img src="https://i.imgur.com/szY2DUu.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<br />Input the Username and Password for your Vulnerable Machine<br/>
<img src="https://i.imgur.com/EJ51Vsh.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<img src="https://i.imgur.com/C2zmTvZ.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<br />Example Credentialed Scan<br/>
<img src="https://i.imgur.com/LdJHXFs.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<br />Now compare the results from the uncredentialed scan to this credential scan you will notice that the VM has way more vulnerabilites (83) <br/>
<img src="https://i.imgur.com/vUkKOgC.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>


<h2>Conclusion </h2>
<br />Just go ahead and play around with OpenVAS and test adding new machines with different operating systems update flavors etc and attempt to remediate any vulnerabilites that you may find.<br/>





</p>

<!--
 ```diff
- text in red
+ text in green
! text in orange
# text in gray
@@ text in purple (and bold)@@
```
--!>
